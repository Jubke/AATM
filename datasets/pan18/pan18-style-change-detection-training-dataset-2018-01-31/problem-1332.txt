The EU wants citizens to retain their existing rights. That means, for example, that they can leave the UK and come back at a later date. The current UK offer terminates if you leave for too long without obtaining full citizenship. Similarly, UK ex-pats are concerned that they will be stuck in the EU country they are in now, losing the right to move to a different one for work. The two major sticking points at the moment (October 2017) are: 

The UK has many made financial commitments. As well as agreeing the EU budget up to at least 2021, it is committed to funding various EU projects. Pensions for EU staff (including British staff), funding for development projects, funding for licencing and regulatory authorities, research and more have all been agreed to. 

The EU requires a commitment in principal to honour these commitments, with the exact amount to be calculated later but thought to be around €60bn. The UK has committed only to the EU budget during a transition period, not all the other stuff. 

Family members are also a major unresolved issue. Freedom of movement allows family members, even non-EU ones, to join the person exercising their treaty rights. This bypasses the local immigration system entirely. Failure to maintain existing rights would rip families apart. 

There is also the issue of jurisdiction. The UK is adamant that the European Court of Justice (ECJ) can no longer have control after Brexit, but the EU is unwilling to allow this because the UK courts are already failing to comply with agreed EU rules. For example, the current treatment of non-EU family members is under active investigation. The UK has made a basic offer to give EU citizens already in the UK a fast track permanent residency application service. So far it has been a bit of a fiasco, initially requiring an 85 page form to be filled out and being rather expensive. On top of that the Home Office has been pushing hard to make people leave the country, resulting in letters threatening deportation being sent in "error". 

The Human Rights record in Saudi Arabia is poor, and many are opposed to arms sales to the Saudi government, however, there has not been a major massacre of protesters in Saudi Arabia that is comparable. 

This is the judgement that an armed officer has to make. Are lives at risk if I don't kill this person? So if a person were to draw a knife and attempt to stab one of the guards, or if a person were to approach the gate wearing what seemed to be an explosive vest, then there is a clear threat to life and lethal force is justified. However, it is not clear that anyone's life was ever threatened by any member of the crowd. The broken leg occurred when a guard tried to kick/trip a running person and fell awkwardly. To kill any person in the crowd would be disproportionate. And so if you don't intend to use your gun, you don't draw it. 

It would be unacceptable to many in the EU and USA for weapons to be used for killing protestors in this way, and aware of this the EU and USA continue to prevent arms exports to China. The UK has many made financial commitments. As well as agreeing the EU budget up to at least 2021, it is committed to funding various EU projects. Pensions for EU staff (including British staff), funding for development projects, funding for licencing and regulatory authorities, research and more have all been agreed to. The EU requires a commitment in principal to honour these commitments, with the exact amount to be calculated later but thought to be around €60bn. The UK has committed only to the EU budget during a transition period, not all the other stuff. 

The two major sticking points at the moment (October 2017) are: 

The UK has made a basic offer to give EU citizens already in the UK a fast track permanent residency application service. So far it has been a bit of a fiasco, initially requiring an 85 page form to be filled out and being rather expensive. On top of that the Home Office has been pushing hard to make people leave the country, resulting in letters threatening deportation being sent in "error". The EU wants citizens to retain their existing rights. That means, for example, that they can leave the UK and come back at a later date. The current UK offer terminates if you leave for too long without obtaining full citizenship. Similarly, UK ex-pats are concerned that they will be stuck in the EU country they are in now, losing the right to move to a different one for work. 

This is the judgement that an armed officer has to make. Are lives at risk if I don't kill this person? So if a person were to draw a knife and attempt to stab one of the guards, or if a person were to approach the gate wearing what seemed to be an explosive vest, then there is a clear threat to life and lethal force is justified. However, it is not clear that anyone's life was ever threatened by any member of the crowd. The broken leg occurred when a guard tried to kick/trip a running person and fell awkwardly. To kill any person in the crowd would be disproportionate. And so if you don't intend to use your gun, you don't draw it. The relevant laws are Spanish Laws, and Human Rights Laws, not European law or the terms of the Schengen treaty. 

It would be unacceptable to many in the EU and USA for weapons to be used for killing protestors in this way, and aware of this the EU and USA continue to prevent arms exports to China.